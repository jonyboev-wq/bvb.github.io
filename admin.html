
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî BVB</title>
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css">
  <script defer src="common.js"></script>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">
      <a href="index.html"><img src="logo.png" alt="BVB"></a>
      <div><h1>BVB</h1><p class="tag">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</p></div>
    </div>
    <div class="nav-actions">
      <button class="btn icon-btn" id="theme-btn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"><span id="theme-icon" class="icon">üåô</span></button>
    </div>
  </div>
</header>

<main class="container">
  <section class="card pad">
    <h3 style="margin-top:0">–¢–æ–≤–∞—Ä—ã</h3>
    <div id="items"></div>
    <button class="btn" id="add">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

    <div style="display:flex; gap:8px; margin-top:14px">
      <button class="btn primary" id="download">–°–∫–∞—á–∞—Ç—å JSON</button>
    </div>
    <div class="small" style="margin-top:8px; color:var(--muted)">–°–∫–∞—á–∞–π—Ç–µ JSON –∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª <code>shopConfig.json</code> –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.</div>
  </section>
</main>

<script>
applyTheme(localStorage.getItem(THEME_KEY)||'light'); updateThemeIcon();
document.getElementById('theme-btn').addEventListener('click', toggleTheme);

if(prompt('–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∫–∏:')!=='popkop06'){ alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'); location.href='index.html'; }

let cfg;
function renderItems(){
  const wrap = document.getElementById('items'); wrap.innerHTML='';
  (cfg.products||[]).forEach((p,i)=>{ 
    const el = document.createElement('div'); el.className='card pad'; el.style.marginBottom='10px';
    el.innerHTML = `
      <div class="grid" style="gap:8px">
        <input class="card pad" style="grid-column:span 6" value="${p.title||''}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" data-k="title" data-i="${i}">
        <input class="card pad" style="grid-column:span 3" value="${p.price||0}" placeholder="–¶–µ–Ω–∞" data-k="price" data-i="${i}">
        <input class="card pad" style="grid-column:span 3" value="${p.tag||''}" placeholder="–ë–µ–π–¥–∂" data-k="tag" data-i="${i}">
        <input class="card pad" style="grid-column:span 6" value="${p.slug||''}" placeholder="Slug" data-k="slug" data-i="${i}">
        <input class="card pad" style="grid-column:span 6" value="${p.img||''}" placeholder="–ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ" data-k="img" data-i="${i}">
        <textarea class="card pad" style="grid-column:span 12; min-height:90px" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" data-k="desc" data-i="${i}">${p.desc||''}</textarea>
      </div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn" onclick="del(${i})">–£–¥–∞–ª–∏—Ç—å</button>
      </div>`;
    wrap.appendChild(el);
  });
  Array.from(wrap.querySelectorAll('input, textarea')).forEach(inp=>{ 
    inp.addEventListener('input', (e)=>{
      const i = +e.target.dataset.i; const k = e.target.dataset.k; let val = e.target.value;
      if(k==='price') val = +val||val;
      cfg.products[i][k]=val;
    });
  });
}
function del(i){ cfg.products.splice(i,1); renderItems(); }
document.getElementById('add').addEventListener('click', ()=>{ (cfg.products||(cfg.products=[])).push({title:'–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä', price:0, desc:'', img:''}); renderItems(); });

loadConfig().then(c=>{ cfg=c; renderItems(); });

document.getElementById('download').addEventListener('click', ()=>{
  const data = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(cfg,null,2));
  const a = document.createElement('a'); a.href=data; a.download='shopConfig.json'; a.click();
});
</script>
</body>
</html>
