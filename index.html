
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BVB ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</title>
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css">
  <script defer src="common.js"></script>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">
      <img src="logo.png" alt="BVB">
      <div>
        <h1 id="brand-name">BVB</h1>
        <p class="tag" id="brand-tag">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞</p>
      </div>
    </div>
    <div class="nav-actions">
      <a class="btn" href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
      <a class="btn" href="wholesale.html">–û–ø—Ç</a>
      <button class="btn icon-btn" id="theme-btn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"><span id="theme-icon" class="icon">üåô</span></button>
      <a class="btn" id="cart-btn" href="#" onclick="openCart();return false;">üß∫ <span id="cart-count">0</span></a>
    </div>
  </div>
</header>

<main class="container">
  <section class="hero">
    <h2 class="title" id="hero-title">–õ—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–æ —á–µ—Å—Ç–Ω—ã–º —Ü–µ–Ω–∞–º</h2>
    <p class="subtitle" id="hero-sub">–ú—ã —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–±–∏—Ä–∞–µ–º –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑—ã –ø–æ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–µ. –î–ª—è –æ–ø—Ç–æ–≤—ã—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.</p>
    <div id="alert" class="alert" style="display:none"></div>
  </section>

  <section class="card pad">
    <div class="socials" id="socials"></div>
  </section>

  <section id="catalog" class="grid" style="margin-top:12px"></section>
</main>

<footer class="container">
  <div class="small">¬© <span id="year"></span> <span id="footer-name">BVB</span>. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
</footer>

<a class="btn admin-fab" href="admin.html" title="–ê–¥–º–∏–Ω–∫–∞">‚öôÔ∏è</a>

<script>
applyTheme(localStorage.getItem(THEME_KEY)||'light'); updateThemeIcon(); updateCartCount();
document.getElementById('theme-btn').addEventListener('click', toggleTheme);
document.getElementById('year').textContent = new Date().getFullYear();

function socialsIcons(name){
  const map = {
    telegram: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9.036 15.47l-.38 5.36c.54 0 .78-.23 1.06-.51l2.53-2.43 5.26 3.84c.96.53 1.65.25 1.92-.89l3.47-16.27c.31-1.44-.52-2-1.46-1.65L1.05 9.22C-.35 9.78-.32 10.62.81 10.98l5.2 1.62L19.38 5.2c.62-.4 1.18-.18.72.22"/></svg>',
    whatsapp: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3.9A10 10 0 004 18.6L3 22l3.5-.9A10 10 0 1019.9 4L20 3.9zm-8 16a8 8 0 110-16 8 8 0 010 16z"/></svg>',
    avito: '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="7" cy="7" r="3"/><circle cx="16" cy="6" r="2"/><circle cx="18" cy="14" r="3"/><circle cx="8" cy="17" r="2.5"/></svg>'
  };
  return map[name]||'';
}

function formatPrice(p){
  if (typeof p === 'number') return p.toLocaleString('ru-RU') + ' ‚ÇΩ';
  if (!p) return '';
  // try parse number from string
  const num = Number(String(p).replace(/[^0-9.,]/g,'').replace(',','.'));
  return isNaN(num) ? String(p) : num.toLocaleString('ru-RU') + ' ‚ÇΩ';
}

function renderHome(cfg){
  document.getElementById('brand-name').textContent = cfg.name || 'BVB';
  document.getElementById('footer-name').textContent = cfg.name || 'BVB';
  document.getElementById('brand-tag').textContent = cfg.tag || '';
  document.getElementById('hero-title').textContent = cfg.heroTitle || '';
  document.getElementById('hero-sub').textContent = cfg.heroSub || '';

  const alertEl = document.getElementById('alert');
  if(cfg._fromFallback){
    alertEl.style.display='block';
    alertEl.textContent = 'shopConfig.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Ä—è–¥–æ–º —Å index.html).';
  }

  const socials = document.getElementById('socials'); socials.innerHTML = '';
  (cfg.socials||[]).forEach(s => { const a = document.createElement('a'); a.href=s.url; a.target='_blank'; a.rel='noopener'; a.innerHTML = socialsIcons(s.icon) + '<span>'+s.label+'</span>'; socials.appendChild(a); });

  const grid = document.getElementById('catalog'); grid.innerHTML = '';
  (cfg.products||[]).forEach(p => { 
    const slug = p.slug || slugify(p.title);
    const card = document.createElement('a'); card.className='card pad product'; card.href = 'product.html?slug='+encodeURIComponent(slug);
    card.innerHTML = `<img src="${p.img||''}" alt="${p.title||''}"><div><h3>${p.title||''}</h3><div class="tag">${p.tag||''}</div><p class="small" style="margin:6px 0 10px">${p.desc||''}</p><div class="price">${formatPrice(p.price)}</div></div>`;
    grid.appendChild(card);
  });
}

// Modal cart
function openCart(){
  const cart = getCart();
  let html = '<div style="max-width:640px;margin:20px auto;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)">';
  html += '<h3 style="margin-top:0">–ö–æ—Ä–∑–∏–Ω–∞</h3>';
  if(!cart.length){ html+='<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</p>'; } else { 
    let total=0;
    cart.forEach((it,i)=>{ 
      const priceNum = Number(String(it.price).replace(/[^0-9.,]/g,'').replace(',','.')) || 0;
      const sum = priceNum*(it.qty||1); total+=sum;
      html += `<div style="display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);padding:10px 0">
        <img src="${it.img||''}" style="width:64px;height:64px;border-radius:10px;object-fit:cover;border:1px solid var(--border)}">
        <div style="flex:1;min-width:0"><div><b>${it.title||''}</b></div><div class="small">${formatPrice(it.price)} √ó ${it.qty||1}</div></div>
        <button class="btn" onclick="removeItem(${i})">√ó</button>
      </div>`;
    });
    html += `<div style="text-align:right;margin-top:10px"><b>–ò—Ç–æ–≥–æ: ${formatPrice(total)}</b></div>`;
  }
  html += '<div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">    <button class="btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>    <button class="btn primary" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>  </div></div>';
  showModal(html);
}
function removeItem(i){ const c=getCart(); c.splice(i,1); saveCart(c); closeModal(); openCart(); }

let modalWrap;
function showModal(inner){
  closeModal();
  modalWrap = document.createElement('div');
  modalWrap.style = "position:fixed;inset:0;background:rgba(0,0,0,.35);display:grid;place-items:center;z-index:50;padding:16px";
  modalWrap.innerHTML = inner;
  modalWrap.addEventListener('click', (e)=>{ if(e.target===modalWrap) closeModal(); });
  document.body.appendChild(modalWrap);
}
function closeModal(){ if(modalWrap){ modalWrap.remove(); modalWrap=null; } }

function checkout(){ alert('–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.'); closeModal(); saveCart([]); updateCartCount(); }

loadConfig().then(cfg=>renderHome(cfg)).catch(err=>{console.error(err); document.getElementById('alert').style.display='block'; document.getElementById('alert').textContent='–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.';});
</script>
</body>
</html>
