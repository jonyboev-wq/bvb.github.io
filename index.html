<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BVB — официальный магазин</title>
  <meta name="description" content="Каталог, оптовые заявки, карточки товара, ссылки на соцсети." />
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css">
  <script defer src="common.js"></script>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo">BVB</div>
      <div>
        <h1>BVB</h1>
        <p>Официальная страница магазина</p>
      </div>
    </div>
    <div class="actions">
      <a class="btn" href="#catalog">Каталог</a>
      <a class="btn" href="wholesale.html">Опт</a>
      <button class="btn icon" id="theme-btn" aria-label="Сменить тему"></button>
    </div>
  </div>
</header>

<main class="container">
  <section class="hero section">
    <h2 class="title">Лучшие товары по честным ценам</h2>
    <p class="subtitle">Мы тщательно отбираем ассортимент и отправляем заказы по всей стране. Для оптовых покупателей — специальные условия.</p>
    <div class="socials-wrap">
      <div class="socials" id="socials"></div>
    </div>
  </section>

  <section id="catalog" class="section">
    <div id="product-grid" class="grid"></div>
  </section>
</main>

<footer class="container">
  <div class="small">© <span id="year"></span> BVB. Все права защищены.</div>
</footer>

<script>
(async function(){
  const cfg = await loadConfig();

  // Соцсети (иконки по центру, аккуратный отступ)
  const s = document.getElementById('socials');
  s.innerHTML = '';
  const socials = [
    { label:'Avito', url: cfg.socials?.avito || '#', icon:'avito' },
    { label:'Telegram', url: cfg.socials?.telegram || '#', icon:'telegram' },
    { label:'WhatsApp', url: cfg.socials?.whatsapp || '#', icon:'whatsapp' },
  ];
  socials.forEach(x=>{
    const a = document.createElement('a');
    a.className = 'pill'; a.href = x.url; a.target = '_blank'; a.rel='noopener';
    a.innerHTML = svgIcon(x.icon) + '<span>'+x.label+'</span>';
    s.appendChild(a);
  });

  // Каталог
  const grid = document.getElementById('product-grid');
  cfg.products.forEach(p => {
    const card = document.createElement('article');
    card.className = 'card pad product-card';
    card.innerHTML = `
      <img src="${(p.photos && p.photos[0]) || p.img}" alt="${p.title}">
      <div>
        <h3>${p.title}</h3>
        ${p.tag ? `<div class="tag">${p.tag}</div>` : ''}
        <div class="price">${p.price}</div>
        <div class="actions-row">
          ${p.avito ? `<a class="btn avito-btn" href="${p.avito}" target="_blank" rel="noopener">Открыть на Avito</a>` : ''}
          <a class="btn secondary" href="product.html?slug=${encodeURIComponent((p.slug||'') || (p.title||'').toLowerCase().replace(/\s+/g,'-'))}">Подробнее</a>
        </div>
      </div>
    `;
    // кликабельность всей карточки
    card.addEventListener('click', (e)=>{
      const target = e.target;
      if(target.closest('a')) return; // не перехватываем клики по кнопкам
      location.href = "product.html?slug=" + encodeURIComponent((p.slug||'') || (p.title||'').toLowerCase().replace(/\s+/g,'-'));
    });
    grid.appendChild(card);
  });

  // Год
  document.getElementById('year').textContent = new Date().getFullYear();

  // Theme button (icon only)
  const btn = document.getElementById('theme-btn');
  function refreshIcon(){
    const cur = localStorage.getItem('theme') || 'dark';
    btn.innerHTML = svgIcon(cur==='dark' ? 'sun' : 'moon');
  }
  refreshIcon();
  btn.addEventListener('click', ()=>{ toggleTheme(); refreshIcon(); });
})();
</script>
</body>
</html>
