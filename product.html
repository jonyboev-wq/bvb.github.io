<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–¢–æ–≤–∞—Ä ‚Äî BVB</title>
<link rel="stylesheet" href="style.css" />
<link rel="icon" href="favicon.ico">
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">
      <div class="brand-logo">BVB</div>
      <div>
        <h1>BVB</h1>
        <small>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞</small>
      </div>
    </div>
    <div class="nav-actions">
      <a class="btn" href="index.html">–ö–∞—Ç–∞–ª–æ–≥</a>
      <a class="btn" href="wholesale.html">–û–ø—Ç</a>
      <button class="btn icon" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
    </div>
  </div>
</header>

<main class="container p-wrap">
  <a class="btn small" href="index.html">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
  <div id="content" class="p-hero"></div>
</main>

<footer class="container">¬© <span id="year"></span> BVB</footer>

<script>
// Theme toggle
(function(){
  const saved = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-theme', saved);
  const b = document.getElementById('themeToggle');
  b.textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  b.addEventListener('click',()=>{
    const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', cur);
    localStorage.setItem('theme', cur);
    b.textContent = cur === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  });
})();

const FALLBACK = {
  products:[
    {
      title:"–õ—ã–∂–Ω—ã–µ —Å–∫—Ä–µ–ø–∫–∏ Fischer",
      slug:"fischer-clips",
      price:99,
      tag:"–•–∏—Ç –ø—Ä–æ–¥–∞–∂",
      desc:"–ü—Ä–æ—á–Ω—ã–µ —Å–∫—Ä–µ–ø–∫–∏ –¥–ª—è –ª—ã–∂ Fischer.",
      avitoUrl:"https://www.avito.ru/",
      images:[
        "https://raw.githubusercontent.com/jonyboev-wq/bvb.github.io/main/IMG_3280.jpeg",
        "https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=1600&auto=format&fit=crop"
      ]
    }
  ]
};

function qs(name){
  const u = new URL(location.href);
  return u.searchParams.get(name) || '';
}
async function loadConfig(){
  try{
    const res = await fetch('shopConfig.json',{cache:'no-store'});
    if(!res.ok) throw new Error('no file');
    return await res.json();
  }catch(e){ return FALLBACK; }
}
function rubl(n){ try{ return new Intl.NumberFormat('ru-RU').format(n) + ' ‚ÇΩ'; }catch(_){ return n + ' ‚ÇΩ'; } }
function el(html){ const d=document.createElement('div'); d.innerHTML=html.trim(); return d.firstChild; }

function renderProduct(p){
  const target=document.getElementById('content'); target.innerHTML='';
  const main = (p.images&&p.images[0])||'';
  const view = el(`
    <>
      <div>
        <img id="pMain" class="p-main" src="${main}" alt="${p.title}">
        <div class="p-thumbs" id="thumbs"></div>
      </div>
      <div>
        <h2 class="p-title">${p.title}</h2>
        ${p.tag? `<div class="badge" style="margin:8px 0 6px">${p.tag}</div>`:''}
        <div class="price" style="font-size:20px">${rubl(p.price)}</div>
        <p class="p-desc">${p.desc||''}</p>
        <div class="p-buttons">
          <a class="btn primary" target="_blank" rel="noopener" href="${p.avitoUrl||'#'}">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Avito</a>
          <a class="btn" href="wholesale.html">–û–ø—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞</a>
        </div>
      </div>
    </>
  `);
  // Because fragments aren't supported in el(), append children
  target.appendChild(view.children[0]);
  target.appendChild(view.children[0]);

  const thumbs=document.getElementById('thumbs');
  (p.images||[]).forEach((src,i)=>{
    const im = document.createElement('img');
    im.src = src; im.alt = p.title + ' ' + (i+1);
    if(i===0) im.classList.add('active');
    im.addEventListener('click',()=>{
      document.getElementById('pMain').src = src;
      [...thumbs.children].forEach(c=>c.classList.remove('active'));
      im.classList.add('active');
    });
    thumbs.appendChild(im);
  });
}

(async function init(){
  const slug = qs('slug');
  const cfg = await loadConfig();
  const p = (cfg.products||[]).find(x => (x.slug||'').toLowerCase() === (slug||'').toLowerCase());
  if(!p){
    document.getElementById('content').innerHTML = '<p>–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω.</p>';
  }else{
    renderProduct(p);
  }
  document.getElementById('year').textContent = new Date().getFullYear();
})();
</script>
</body>
</html>
