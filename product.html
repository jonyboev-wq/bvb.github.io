<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Товар — BVB</title>
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css">
  <script defer src="common.js"></script>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo">BVB</div>
      <div>
        <h1>BVB</h1>
        <p>Карточка товара</p>
      </div>
    </div>
    <div class="actions">
      <a class="btn" href="index.html#catalog">Каталог</a>
      <a class="btn" href="wholesale.html">Опт</a>
      <button class="btn icon" id="theme-btn" aria-label="Сменить тему"></button>
    </div>
  </div>
</header>

<main class="container">
  <section class="card pad product-hero section" id="view" style="min-height:200px">
    Загрузка...
  </section>
</main>

<footer class="container">
  <div class="small">© <span id="year"></span> BVB</div>
</footer>

<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const slug = params.get('slug');
  const cfg = await loadConfig();
  const prod = cfg.products.find(p => (p.slug || p.title.toLowerCase().replace(/\s+/g,'-')) === slug);
  const view = document.getElementById('view');
  if(!prod){ view.innerHTML = 'Товар не найден'; return; }

  const photos = prod.photos && prod.photos.length ? prod.photos : (prod.img ? [prod.img] : []);
  const main = photos[0] || '';
  view.innerHTML = `
    <div class="gallery">
      <img id="g-main" class="gallery-main" src="${main}" alt="${prod.title}">
      <div class="thumbs" id="g-thumbs"></div>
    </div>
    <div class="meta">
      <h2>${prod.title}</h2>
      ${prod.tag ? `<div class="tag" style="margin:8px 0">${prod.tag}</div>` : ''}
      <div class="price">${prod.price}</div>
      <p class="desc">${prod.desc||''}</p>
      <div class="actions-row" style="margin-top:14px">
        ${prod.avito ? `<a class="btn avito-btn" href="${prod.avito}" target="_blank" rel="noopener">Открыть на Avito</a>` : ''}
        <a class="btn" href="wholesale.html?topic=${encodeURIComponent('Опт по товару: '+prod.title)}">Оптовая заявка</a>
      </div>
      ${prod.specs ? `<div class="section"><div class="small">Характеристики:</div><pre style="white-space:pre-wrap;margin:6px 0 0">${prod.specs}</pre></div>`:''}
      <div class="notice">Если не нашли нужную комплектацию — напишите нам в Telegram.</div>
    </div>
  `;

  // thumbs
  const thumbs = document.getElementById('g-thumbs');
  photos.forEach((url, i)=>{
    const t = document.createElement('img');
    t.src = url; if(i===0) t.classList.add('active');
    t.addEventListener('click', ()=>{
      document.getElementById('g-main').src = url;
      [...thumbs.children].forEach(ch=>ch.classList.remove('active'));
      t.classList.add('active');
    });
    thumbs.appendChild(t);
  });

  // theme icon
  const btn = document.getElementById('theme-btn');
  function refreshIcon(){ const cur = localStorage.getItem('theme') || 'dark'; btn.innerHTML = svgIcon(cur==='dark' ? 'sun':'moon');}
  refreshIcon(); btn.addEventListener('click', ()=>{toggleTheme(); refreshIcon();})

  document.getElementById('year').textContent = new Date().getFullYear();
})();
</script>
</body>
</html>
