<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ ‚Äî BVB</title>
  <link rel="icon" href="logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff;
      --card:#f6f8fa;
      --muted:#5b6b7b;
      --text:#0f1720;
      --btn:#111;
      --btnText:#fff;
      --btnGhostBg:#ffffff;
      --btnGhostText:#111;
      --border:#e5e7eb;
      --radius:16px;
      --maxw:1100px;
    }
    [data-theme="dark"]{
      --bg:#0b0f14;
      --card:#11161d;
      --muted:#95a1af;
      --text:#eaf0f6;
      --btn:#e9eef7;
      --btnText:#0b0d12;
      --btnGhostBg:#12151c;
      --btnGhostText:#e9eef7;
      --border:#1b2530;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:"Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
    }
    .container{max-width:var(--maxw);margin:0 auto;padding:16px}
    header{
      position:sticky;top:0;z-index:50;
      background:rgba(255,255,255,.6);
      backdrop-filter:saturate(140%) blur(12px);
      border-bottom:1px solid var(--border);
    }
    [data-theme="dark"] header{background:rgba(11,13,18,.6);}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--btnGhostBg);color:var(--btnGhostText);cursor:pointer;text-decoration:none}
    .btn.icon{width:40px;height:40px;padding:0}
    .btn.primary{background:var(--btn);border-color:var(--btn);color:var(--btnText)}
    .btn:hover{transform:translateY(-1px)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));border:1px solid var(--border);border-radius:var(--radius)}
    .pad{padding:16px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:16px}
    .title{margin:0 0 6px}
    .muted{color:var(--muted)}
    .price{font-size:28px;font-weight:800}
    .old{color:var(--muted);text-decoration:line-through;margin-left:8px;font-weight:600}
    .badge{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px dashed var(--border);font-size:12px;color:var(--muted)}
    .gallery{display:grid;grid-template-columns:1fr;gap:12px}
    .hero{width:100%;aspect-ratio:1/1;border-radius:12px;border:1px solid var(--border);object-fit:cover;background:#0a1016}
    .thumbs{display:flex;gap:8px;flex-wrap:wrap}
    .thumbs img{width:72px;height:72px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer}
    .thumbs img.active{border-color:var(--btn)}
    .desc{white-space:pre-wrap}
    .empty{padding:24px;border:1px dashed var(--border);border-radius:12px;text-align:center;color:var(--muted)}
    @media (max-width: 840px){ .grid{grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header>
    <div class="container row">
      <div class="row" style="gap:10px">
        <a class="btn" href="index.html">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a class="btn" href="wholesale.html">–û–ø—Ç</a>
        <button class="btn icon" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
      </div>
      <a class="btn" href="javascript:history.back()">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
  </header>

  <main class="container" id="app">
    <div class="empty">–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä‚Ä¶</div>
  </main>

  <script>
    (function(){
      const saved = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', saved);
      const b = document.getElementById('themeToggle');
      b.textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      b.addEventListener('click',()=>{
        const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', cur);
        localStorage.setItem('theme', cur);
        b.textContent = cur === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      });
    })();

    async function loadConfig(){
      try{
        const res = await fetch('shopConfig.json', {cache:'no-cache'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        return await res.json();
      }catch(e){
        document.getElementById('app').innerHTML = '<div class="empty">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å shopConfig.json. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.</div>';
        throw e;
      }
    }
    function qs(name){
      const p = new URLSearchParams(location.search);
      return p.get(name) || '';
    }
    function render(p){
      if(!p){
        document.getElementById('app').innerHTML = '<div class="empty">–¢–æ–≤–∞—Ä –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä <b>slug</b> –≤ URL.</div>';
        return;
      }
      const imgs = Array.isArray(p.images) && p.images.length ? p.images : [];
      const hero = imgs[0] || '';
      const gallery = imgs.map((src,i)=>'<img '+(i===0?'class="active"':'')+' src="'+src+'" alt="">').join('');
      const old = (p.oldPrice && p.oldPrice>p.price) ? '<span class="old">'+p.oldPrice+' '+(p.currency||'‚ÇΩ')+'</span>' : '';
      const tag = p.tag ? '<span class="badge">'+p.tag+'</span>' : '';
      const stock = p.stock ? '<span class="badge">'+p.stock+'</span>' : '';
      document.getElementById('app').innerHTML = `
        <div class="grid">
          <section class="card pad gallery">
            <img id="hero" class="hero" src="${hero}" alt="${p.title}">
            <div class="thumbs" id="thumbs">${gallery}</div>
          </section>
          <section class="card pad">
            <h1 class="title">${p.title}</h1>
            <div class="muted" style="margin-bottom:10px">${p.category||''}</div>
            <div style="display:flex;gap:8px;margin:10px 0 14px">${tag}${stock}</div>
            <div class="price">${p.price} ${(p.currency||'‚ÇΩ')}${old}</div>
            <p class="muted" style="margin:6px 0 14px">${p.short||''}</p>
            <div class="desc">${(p.description||'').replaceAll('\n','<br>')}</div>
            <div style="display:flex;gap:10px;margin-top:16px">
              ${p.avitoUrl ? '<a class="btn primary" target="_blank" rel="noopener" href="'+p.avitoUrl+'">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Avito</a>' : ''}
              <a class="btn" href="index.html">–ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
            </div>
          </section>
        </div>
      `;
      const heroEl = document.getElementById('hero');
      const thumbs = document.getElementById('thumbs');
      thumbs?.addEventListener('click', (e)=>{
        const t = e.target;
        if(t.tagName==='IMG'){ 
          heroEl.src = t.src;
          [...thumbs.children].forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
        }
      });
    }
    (async()=>{
      const slug = qs('slug');
      const cfg = await loadConfig();
      const prod = (cfg.products||[]).find(x=> (x.slug||'') === slug);
      render(prod);
    })();
  </script>
</body>
</html>
